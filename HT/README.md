# Отчет поправлю еще к мягкому дедлайну

## План работы

#### Нагрузочное тестирование: 

[X] 1. Разработать профиль нагрузки для системы

[X] 2. Реализовать профиль на любом инструменте НТ (разработать скрипт)

[X] 3. Задать нефункциональные требования по производительности к системе (SLO/SLA)

[X] 4. Найти максимальную производительность системы

[X] 5. Написать краткий вывод: где достигнута максимальная производительность, где узкое место в системе, для подтверждения привести графики.



#### Хаос Тестирование: 

[X] 1. Отключение узла: Планово остановить один из узлов кластера, чтобы проверить процедуру
переключения ролей (failover). - Анализировать время, необходимое для восстановления и как
система выбирает новый Master узел (и есть ли вообще там стратегия выбора?).

[X] 2.Имитация частичной потери сети: Использовать инструменты для имитации потери пакетов
или разрыва TCP-соединений между узлами. Цель — проверить, насколько хорошо система
справляется с временной недоступностью узлов и как быстро восстанавливается репликация.

[ ] 3.Имитация задержек в сети:

[X] 4. Высокая нагрузка на CPU: Запустить процессы, которые создают высокую нагрузку на CPU одного из узлов кластера, чтобы проверить, как это влияет на
производительность кластера в целом и на работу Patroni.

[ ] 5. Высокая нагрузка на  I/O: Запустить процессы, которые создают высокую нагрузку на  I/O одного из узлов кластера, чтобы проверить, как это влияет на
производительность кластера в целом и на работу Patroni.

[X] 6. Тестирование систем мониторинга и оповещения: С помощью chaos engineering можно также
проверить, насколько эффективны системы мониторинга и оповещения. Например, можно
искусственно вызвать отказ, который должен быть зарегистрирован системой мониторинга, и
убедиться, что оповещения доставляются вовремя ?

[ ] 7. ”Split-brain": Одновременно изолировать несколько узлов от сети и дать им возможность
объявить себя новыми мастер-узлами. Проверить, успеет ли Patroni достичь
консенсуса и избежать ситуации "split-brain".

[X] 8. Долгосрочная изоляция: Оставить узел изолированным от кластера на длительное время, затем восстановить соединение и наблюдать за процессом синхронизации и
восстановления реплики.

[X] 9. Сбои сервисов зависимостей: Изучить поведение кластера Patroni при сбоях в сопутствующих сервисах, например, etcd (которые используются для хранения состояния кластера),
путем имитации его недоступности или некорректной работы.




## Отчет
HT.doc

## TODO: 
[ ] 1. Сделать запись в influxdb метрик рассчитываемых (сделал, но время записи большое, стоит разобраться с чем связано.) 

## Установка 
1. Установить Python 
2. Установить зависимости из src/requirements.txt 

## Примеры 
**Для запуска нужно находиться в корневой папке проекта -> mts-sre.** 

Пример запуска на 1 пк в 1 процесс
```bash
locust -f HT/locust/src/tests/forecast_max_perf.py,HT/locust/src/tests/weather_forecast_max_perf.py,HT/locust/src/tests/city_max_perf.py,HT/locust/src/tests/load_shape/increase_steps.py 
```
Пример запуска на 1 пк в несколько процессов
В первом терминале 
```bash
locust -f HT/locust/src/tests/forecast_max_perf.py,HT/locust/src/tests/city_max_perf.py,HT/locust/src/tests/load_shape/increase_steps_no_data_in_db.py --master
```
Во втором терминале 
```bash
locust -f HT/locust/src/tests/forecast_max_perf.py,HT/locust/src/tests/city_max_perf.py,HT/locust/src/tests/load_shape/increase_steps_no_data_in_db.py --worker --master-host=localhost
```



## Другие инструменты НТ 
Просто полезные команды, для быстрых тестов, используя [vegeta](https://github.com/tsenart/vegeta)
```bash
echo "GET http://weather-forecast.ddns.net/Cities" | vegeta attack -duration=10m -rate=10/s 
```
```bash
echo "GET https://weather-forecast.ddns.net/Cities/1" | vegeta attack -duration=10m -rate=2/s 
```
```bash
echo "GET https://weather-forecast.ddns.net/Cities/122" | vegeta attack -duration=10m -rate=2/s 
```



sudo ./chaosblade-1.7.2/blade create disk burn -d --read 10024 --timeout 30

https://askubuntu.com/a/741217